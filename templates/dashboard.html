<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bitcoin Scalping Dashboard</title>

  <!-- Chart.js + Financial plugin -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

  <style>
    :root { --bg:#08101a; --card:#0e1620; --muted:#9fb0c8; --accent:#00e6a8; }
    *{box-sizing:border-box}
    body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:#e6f3fb;margin:0;padding:14px}
    .wrap{max-width:1180px;margin:0 auto}
    .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{font-size:20px;margin:0}
    .controls{display:flex;gap:8px}
    button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
    <!doctype html>
    <html lang="en">
    <head>
      <meta charset="utf-8" />
      <meta name="viewport" content="width=device-width,initial-scale=1" />
      <title>Bitcoin Scalping Dashboard</title>
      <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.min.js"></script>
      <style>
      :root{ --bg:#08101a; --card:#0e1620; --muted:#9fb0c8; --accent:#00e6a8; }
      *{box-sizing:border-box}
      body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:#e6f3fb;margin:0;padding:14px}
      .wrap{max-width:1180px;margin:0 auto}
      .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
      h1{font-size:20px;margin:0}
      .controls{display:flex;gap:8px;align-items:center}
      button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
      .small{color:var(--muted);font-size:13px}
      .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-top:12px}
      .signal{font-size:28px;font-weight:700;text-align:center;margin:8px 0}
      <!DOCTYPE html>
      <html lang="en">
      <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <title>Bitcoin Scalping Dashboard</title>
        <script src="https://cdn.jsdelivr.net/npm/chart.js@3.9.1/dist/chart.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/chartjs-chart-financial@3.3.0/dist/chartjs-chart-financial.min.js"></script>
        <style>
          :root{ --bg:#08101a; --card:#0e1620; --muted:#9fb0c8; --accent:#00e6a8; }
          *{box-sizing:border-box}
          body{font-family:Inter, Arial, sans-serif;background:var(--bg);color:#e6f3fb;margin:0;padding:14px}
          .wrap{max-width:1180px;margin:0 auto}
          .header{display:flex;align-items:center;justify-content:space-between;gap:12px}
          h1{font-size:20px;margin:0}
          .controls{display:flex;gap:8px;align-items:center}
          button{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:8px 10px;border-radius:8px;cursor:pointer}
          .small{color:var(--muted);font-size:13px}
          .card{background:var(--card);padding:12px;border-radius:10px;border:1px solid rgba(255,255,255,0.03);margin-top:12px}
          .signal{font-size:28px;font-weight:700;text-align:center;margin:8px 0}
          .grid{display:grid;grid-template-columns:1fr 360px;gap:12px;margin-top:14px}
          canvas{width:100%!important;height:260px!important}
          @media (max-width:980px){.grid{grid-template-columns:1fr}canvas{height:200px!important}}
          .meta-row{display:flex;justify-content:space-between;align-items:center}
          .levels-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px}
          .muted{color:var(--muted)}
        </style>
      </head>
      <body>
        <div class="wrap">
          <div class="header">
            <div>
              <h1>ðŸš€ Bitcoin Scalping Dashboard</h1>
              <div class="small">Live AI Predictions â€¢ Polling every 3s</div>
            </div>
            <div class="controls">
              <div id="data-source" class="small">Source: --</div>
              <button id="demoBtn">Show Demo</button>
              <button id="refreshBtn">Refresh</button>
            </div>
          </div>

          <div id="alert" class="small" style="margin-top:10px;display:none;color:#ffd2d2"></div>

          <div class="card">
            <div class="meta-row">
              <div>
                <div class="small">Model: <span id="model_version">--</span></div>
                <div class="small">Last update: <span id="last_update">--</span></div>
              </div>
              <div style="text-align:right">
                <div class="small">Live accuracy: <span id="live_accuracy">--</span></div>
                <div class="small">Reliability: <span id="reliability">--</span></div>
              </div>
            </div>

            <div class="signal" id="signal">--</div>

            <div style="display:flex;gap:12px;align-items:center">
              <div style="width:140px;text-align:center">
                <canvas id="confGauge" width="140" height="140"></canvas>
                <div class="small">Confidence</div>
              </div>
              <div style="flex:1">
                <div class="small">Explain</div>
                <div id="explain" style="font-weight:600;margin-top:6px">--</div>
                <div style="margin-top:8px" class="small">Sentiment: <strong id="sentiment">--</strong></div>
              </div>
            </div>

            <div class="levels-grid" style="margin-top:12px">
              <div class="small">Price<div id="price">--</div></div>
              <div class="small">Entry<div id="entry">--</div></div>
              <div class="small">Stop Loss<div id="stop_loss">--</div></div>
            </div>

            <div class="levels-grid" style="margin-top:8px">
              <div class="small">Target 1<div id="target_1">--</div></div>
              <div class="small">Target 2<div id="target_2">--</div></div>
              <div class="small">R:R<div id="risk_reward">--</div></div>
            </div>

            <div style="display:flex;gap:12px;margin-top:10px;align-items:center;justify-content:space-between">
              <div class="small">Trend Strength: <strong id="trend_strength">--</strong></div>
              <div class="small">Volatility: <strong id="volatility">--</strong></div>
              <div class="small">Breakout Proba: <strong id="breakout_probability">--</strong></div>
            </div>
          </div>

          <div class="grid">
            <div>
              <div class="card">
                <div class="small">Price (line)</div>
                <canvas id="lineChart"></canvas>
              </div>

              <div class="card">
                <div class="small">Candles (last 100)</div>
                <canvas id="candleChart"></canvas>
              </div>
            </div>

            <div>
              <div class="card">
                <div class="small">Performance</div>
                <div style="margin-top:8px">Total trades: <strong id="total_trades">--</strong></div>
                <div style="margin-top:4px">Success rate: <strong id="success_rate">--</strong></div>
                <div style="margin-top:4px">Avg conf: <strong id="avg_conf">--</strong></div>
                <canvas id="perfSpark" style="margin-top:8px;height:120px"></canvas>
              </div>

              <div class="card">
                <h3>System Status</h3>
                <div id="system_status">--</div>
              </div>
            </div>
          </div>

          <div class="card">
            <h3>Trade Suggestion</h3>
            <div id="trade_suggestion">--</div>
          </div>

        </div>

        <script>
          // State
          window._demo_active = false;

          // draw gauge
          function drawGauge(id, pct){
            const canvas = document.getElementById(id); if(!canvas) return; const ctx = canvas.getContext('2d'); const w=canvas.width, h=canvas.height; ctx.clearRect(0,0,w,h);
            const r = Math.min(w,h)/2 - 8, cx=w/2, cy=h/2; ctx.lineWidth=12; ctx.beginPath(); ctx.strokeStyle='rgba(255,255,255,0.06)'; ctx.arc(cx,cy,r,0,Math.PI*2); ctx.stroke();
            const start=-Math.PI/2, end = start + Math.max(0,Math.min(1,pct)) * Math.PI*2; const grad=ctx.createLinearGradient(0,0,w,h); grad.addColorStop(0,'#00e6a8'); grad.addColorStop(1,'#00b4db'); ctx.strokeStyle=grad; ctx.beginPath(); ctx.arc(cx,cy,r,start,end); ctx.stroke();
            ctx.fillStyle='#e6eef8'; ctx.font='18px Inter, Arial'; ctx.textAlign='center'; ctx.textBaseline='middle'; ctx.fillText(Math.round(pct*100)+'%',cx,cy);
          }

          // charts
          let lineChart=null, candleChart=null, perfChart=null;
          function renderLine(labels, prices){
            try{
              const ctx = document.getElementById('lineChart').getContext('2d'); if(lineChart) lineChart.destroy(); lineChart = new Chart(ctx,{type:'line',data:{labels:labels,datasets:[{label:'Price',data:prices,borderColor:'#00b4db',backgroundColor:'rgba(0,180,219,0.06)',fill:true,pointRadius:0}]},options:{animation:{duration:200},scales:{x:{ticks:{color:'#9fb0c8'}},y:{ticks:{color:'#9fb0c8'}}},plugins:{legend:{display:false}}});
            }catch(e){console.warn(e)}
          }
          function renderCandles(candles){
            try{
              const ctx = document.getElementById('candleChart').getContext('2d');
              const data = candles.map(c=>({x:new Date(c.t),o:c.o,h:c.h,l:c.l,c:c.c}));
              if(candleChart) candleChart.destroy();
              candleChart = new Chart(ctx,{type:'candlestick',data:{datasets:[{label:'BTC',data:data}]},options:{plugins:{legend:{display:false}},scales:{x:{type:'time',time:{tooltipFormat:'HH:mm'},ticks:{color:'#9fb0c8'}},y:{ticks:{color:'#9fb0c8'}}}});
            }catch(e){console.warn('candles',e)}
          }
          function renderPerf(series){
            try{ const ctx=document.getElementById('perfSpark').getContext('2d'); if(perfChart) perfChart.destroy(); perfChart = new Chart(ctx,{type:'bar',data:{labels:series.map((_,i)=>i),datasets:[{data:series,backgroundColor:'rgba(80,250,123,0.6)'}]},options:{plugins:{legend:{display:false}},scales:{x:{display:false},y:{display:false}}}});
            }catch(e){}
          }

          // apply payload
          function applyPayload(p, source){
            try{
              document.getElementById('signal').textContent = p.signal || p.prediction || 'HOLD';
              document.getElementById('model_version').textContent = p.model_version || '--';
              document.getElementById('last_update').textContent = p.last_update ? new Date(p.last_update).toLocaleString() : '--';
              document.getElementById('live_accuracy').textContent = p.live_accuracy!=null ? (p.live_accuracy*100).toFixed(1)+'%' : '--';
              document.getElementById('reliability').textContent = p.reliability!=null ? (p.reliability*100).toFixed(1)+'%' : '--';
              document.getElementById('explain').textContent = p.explain || p.reason || '--';
              document.getElementById('sentiment').textContent = p.sentiment || '--';
              document.getElementById('price').textContent = p.price!=null ? '$'+Number(p.price).toLocaleString() : '--';
              document.getElementById('entry').textContent = p.entry!=null ? '$'+Number(p.entry).toLocaleString() : '--';
              document.getElementById('stop_loss').textContent = p.stop_loss!=null ? '$'+Number(p.stop_loss).toLocaleString() : '--';

              // targets & RR
              if(p.targets && p.targets.length>0){ document.getElementById('target_1').textContent = '$'+Number(p.targets[0]).toLocaleString(); if(p.targets[1]) document.getElementById('target_2').textContent = '$'+Number(p.targets[1]).toLocaleString(); }
              document.getElementById('risk_reward').textContent = p.risk_reward!=null ? p.risk_reward : '--';

              document.getElementById('trend_strength').textContent = p.trend_strength!=null ? p.trend_strength : '--';
              document.getElementById('volatility').textContent = p.volatility!=null ? p.volatility : '--';
              document.getElementById('breakout_probability').textContent = p.breakout_probability!=null ? (Number(p.breakout_probability).toFixed(3)) : '--';

              // trade suggestion
              if(p.trade_suggestion){ document.getElementById('trade_suggestion').innerHTML = `<strong>${p.trade_suggestion.action}</strong> â€” ${p.trade_suggestion.reason} (size: ${p.trade_suggestion.size})`; }

              // system status
              if(p.system_status){ const s = p.system_status; document.getElementById('system_status').innerHTML = `Status: ${s.status} â€¢ Training: ${s.training_progress || 0}% â€¢ Uptime: ${s.uptime_minutes || 0}m`; }

              // performance
              if(p.performance){ document.getElementById('total_trades').textContent = p.performance.total_trades || 0; document.getElementById('success_rate').textContent = p.performance.success_rate!=null ? (p.performance.success_rate*100).toFixed(1)+'%' : '--'; document.getElementById('avg_conf').textContent = p.performance.avg_confidence!=null ? (p.performance.avg_confidence*100).toFixed(1)+'%' : '--'; if(p.performance.series) renderPerf(p.performance.series); }

              // charts
              if(p.chart){ if(p.chart.timestamps && p.chart.prices) renderLine(p.chart.timestamps, p.chart.prices); if(p.chart.candles && p.chart.candles.length) renderCandles(p.chart.candles); }
              drawGauge('confGauge', Number(p.confidence||0));

              // data source badge
              const ds = document.getElementById('data-source'); if(ds) ds.textContent = 'Source: '+(source||'LIVE');
            }catch(e){ console.warn('applyPayload failed', e); }
          }

          // fetch prediction
          async function fetchPrediction(){
            try{
              const res = await fetch('/api/prediction'); if(!res.ok) throw new Error('HTTP '+res.status); const p = await res.json(); window._demo_active = false; applyPayload(p,'LIVE'); document.getElementById('alert').style.display='none';
            }catch(err){ console.warn('live fetch failed',err); document.getElementById('alert').textContent = 'Live data temporarily unavailable â€” showing last known or demo. Click Refresh.'; document.getElementById('alert').style.display='block'; }
          }

          async function showDemo(){ try{ const res = await fetch('/api/demo'); const p = await res.json(); window._demo_active = true; applyPayload(p,'DEMO'); document.getElementById('alert').style.display='none'; setTimeout(()=>{ if(window._demo_active){ window._demo_active=false; fetchPrediction(); } },15000); }catch(e){console.warn('demo fetch failed',e);} }

          document.getElementById('demoBtn').addEventListener('click', showDemo);
          document.getElementById('refreshBtn').addEventListener('click', ()=>{ window._demo_active=false; fetchPrediction(); });

          // start
          fetchPrediction(); setInterval(()=>{ if(!window._demo_active) fetchPrediction(); },3000);
        </script>
      </body>
      </html>
