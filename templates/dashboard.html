<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Bitcoin Scalping Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        :root {
            --primary: #2563eb;
            --success: #10b981;
            --danger: #ef4444;
            --warning: #f59e0b;
            --dark: #1f2937;
            --darker: #111827;
            --light: #f3f4f6;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--darker), var(--dark));
            color: var(--light);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary), var(--success));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .status-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .status-item {
            background: rgba(255,255,255,0.05);
            padding: 12px 20px;
            border-radius: 10px;
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .main-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        @media (max-width: 1024px) {
            .main-grid {
                grid-template-columns: 1fr;
            }
        }
        
        .card {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 25px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
            transition: transform 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card h2 {
            margin-bottom: 20px;
            color: var(--primary);
            font-size: 1.4rem;
        }
        
        .signal-display {
            text-align: center;
            padding: 30px;
        }
        
        .signal-buy { background: linear-gradient(135deg, rgba(16, 185, 129, 0.2), rgba(16, 185, 129, 0.05)); }
        .signal-sell { background: linear-gradient(135deg, rgba(239, 68, 68, 0.2), rgba(239, 68, 68, 0.05)); }
        .signal-hold { background: linear-gradient(135deg, rgba(245, 158, 11, 0.2), rgba(245, 158, 11, 0.05)); }
        
        .signal-text {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
        }
        
        .signal-buy .signal-text { color: var(--success); }
        .signal-sell .signal-text { color: var(--danger); }
        .signal-hold .signal-text { color: var(--warning); }
        
        .confidence-meter {
            width: 200px;
            height: 200px;
            margin: 0 auto;
            position: relative;
        }
        
        .gauge-container {
            text-align: center;
            margin: 20px 0;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .metric {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 1.5rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .metric-label {
            font-size: 0.9rem;
            opacity: 0.8;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .trading-levels {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .level {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            background: rgba(255,255,255,0.05);
        }
        
        .level.entry { border-left: 4px solid var(--primary); }
        .level.stop { border-left: 4px solid var(--danger); }
        .level.target { border-left: 4px solid var(--success); }
        
        .buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 20px;
        }
        
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .btn-primary {
            background: var(--primary);
            color: white;
        }
        
        .btn-success {
            background: var(--success);
            color: white;
        }
        
        .btn-warning {
            background: var(--warning);
            color: white;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
        }
        
        .explanation {
            margin-top: 20px;
            padding: 20px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
            border-left: 4px solid var(--primary);
        }
        
        .feature-importance {
            margin-top: 15px;
        }
        
        .feature-bar {
            height: 8px;
            background: rgba(255,255,255,0.1);
            border-radius: 4px;
            margin: 5px 0;
            overflow: hidden;
        }
        
        .feature-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary), var(--success));
            border-radius: 4px;
            transition: width 0.5s ease;
        }
        
        .performance-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .stat {
            text-align: center;
            padding: 15px;
            background: rgba(255,255,255,0.05);
            border-radius: 10px;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            margin: 5px 0;
        }
        
        .reliability-badge {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .reliability-high { background: var(--success); color: white; }
        .reliability-medium { background: var(--warning); color: white; }
        .reliability-low { background: var(--danger); color: white; }
        
        .pulse {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .last-update {
            font-size: 0.9rem;
            opacity: 0.7;
            text-align: center;
            margin-top: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üöÄ AI Bitcoin Scalping Dashboard</h1>
            <p>Live AI Predictions ‚Ä¢ Multi-Timeframe Analysis ‚Ä¢ Real-time WebSocket Updates</p>
        </div>
        
        <div class="status-bar">
            <div class="status-item">
                <strong>Source:</strong> <span id="source">Binance API</span>
            </div>
            <div class="status-item">
                <strong>Model:</strong> <span id="model-version">Loading...</span>
            </div>
            <div class="status-item">
                <strong>Last Update:</strong> <span id="last-update">--</span>
            </div>
            <div class="status-item">
                <strong>System Status:</strong> <span id="system-status" class="pulse">Initializing...</span>
            </div>
        </div>
        
        <div class="main-grid">
            <!-- Signal Card -->
            <div class="card">
                <h2>üéØ Trading Signal</h2>
                <div class="signal-display" id="signal-display">
                    <div class="signal-hold">
                        <div class="signal-text">HOLD</div>
                        <div class="gauge-container">
                            <div class="confidence-meter">
                                <canvas id="confidenceGauge" width="200" height="200"></canvas>
                            </div>
                            <div>Confidence: <span id="confidence-value">--</span></div>
                        </div>
                        <div class="reliability">
                            Reliability: <span id="reliability-value">--</span>
                            <span id="reliability-badge" class="reliability-badge reliability-low">LOW</span>
                        </div>
                    </div>
                </div>
                
                <div class="metrics-grid">
                    <div class="metric">
                        <div class="metric-label">Current Price</div>
                        <div class="metric-value" id="current-price">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Sentiment</div>
                        <div class="metric-value" id="sentiment">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Risk/Reward</div>
                        <div class="metric-value" id="risk-reward">--</div>
                    </div>
                    <div class="metric">
                        <div class="metric-label">Volatility</div>
                        <div class="metric-value" id="volatility">--</div>
                    </div>
                </div>
            </div>
            
            <!-- Trading Levels Card -->
            <div class="card">
                <h2>üìä Trading Levels</h2>
                <div class="trading-levels">
                    <div class="level entry">
                        <div class="metric-label">Entry Price</div>
                        <div class="metric-value" id="entry-price">--</div>
                    </div>
                    <div class="level stop">
                        <div class="metric-label">Stop Loss</div>
                        <div class="metric-value" id="stop-loss">--</div>
                    </div>
                    <div class="level target">
                        <div class="metric-label">Target 1</div>
                        <div class="metric-value" id="target-1">--</div>
                    </div>
                    <div class="level target">
                        <div class="metric-label">Target 2</div>
                        <div class="metric-value" id="target-2">--</div>
                    </div>
                </div>
                
                <div class="explanation">
                    <h3>üìù Explanation</h3>
                    <p id="explanation-text">System is initializing. Please wait for first prediction...</p>
                    
                    <div class="feature-importance" id="feature-importance">
                        <h4>Feature Importance:</h4>
                        <!-- Feature bars will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Charts and Performance Row -->
        <div class="main-grid">
            <!-- Chart Card -->
            <div class="card">
                <h2>üìà Price Chart (Last 100 Candles)</h2>
                <div class="chart-container">
                    <canvas id="priceChart"></canvas>
                </div>
            </div>
            
            <!-- Performance Card -->
            <div class="card">
                <h2>üìä Performance Metrics</h2>
                <div class="performance-stats">
                    <div class="stat">
                        <div class="metric-label">Total Trades</div>
                        <div class="stat-value" id="total-trades">--</div>
                    </div>
                    <div class="stat">
                        <div class="metric-label">Success Rate</div>
                        <div class="stat-value" id="success-rate">--</div>
                    </div>
                    <div class="stat">
                        <div class="metric-label">Avg Confidence</div>
                        <div class="stat-value" id="avg-confidence">--</div>
                    </div>
                    <div class="stat">
                        <div class="metric-label">Live Accuracy</div>
                        <div class="stat-value" id="live-accuracy">--</div>
                    </div>
                </div>
                
                <div class="buttons">
                    <button class="btn btn-primary" onclick="refreshData()">üîÑ Refresh</button>
                    <button class="btn btn-success" onclick="showDemo()">üëÅÔ∏è Show Demo</button>
                    <button class="btn btn-warning" onclick="exportData()">üì• Export Data</button>
                </div>
                
                <div class="last-update">
                    Next update in: <span id="countdown">30</span>s
                </div>
            </div>
        </div>
    </div>

    <script>
        // Global variables
        let socket;
        let priceChart;
        let countdown = 30;
        let isDemoMode = false;
        let currentData = null;
        
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeSocket();
            initializeCharts();
            loadInitialData();
            startCountdown();
        });
        
        // Initialize WebSocket connection
        function initializeSocket() {
            socket = io();
            
            socket.on('connect', function() {
                console.log('üîå Connected to server via WebSocket');
                updateSystemStatus('connected');
            });
            
            socket.on('prediction_update', function(data) {
                console.log('üì® Received prediction update:', data);
                currentData = data;
                updateDashboard(data);
                resetCountdown();
            });
            
            socket.on('disconnect', function() {
                console.log('‚ùå Disconnected from server');
                updateSystemStatus('disconnected');
            });
        }
        
        // Load initial data via API
        function loadInitialData() {
            fetch('/api/prediction')
                .then(response => response.json())
                .then(data => {
                    if (data.status !== 'initializing') {
                        currentData = data;
                        updateDashboard(data);
                    }
                })
                .catch(error => {
                    console.error('Error loading initial data:', error);
                });
            
            // Load system status
            fetch('/api/system_status')
                .then(response => response.json())
                .then(data => {
                    document.getElementById('model-version').textContent = data.model_version || '--';
                    updateSystemStatus(data.status);
                });
        }
        
        // Update dashboard with new data
        function updateDashboard(data) {
            // Update signal display
            updateSignalDisplay(data);
            
            // Update metrics
            document.getElementById('current-price').textContent = formatCurrency(data.price);
            document.getElementById('sentiment').textContent = data.sentiment || '--';
            document.getElementById('risk-reward').textContent = data.risk_reward ? data.risk_reward.toFixed(2) + ' : 1' : '--';
            document.getElementById('volatility').textContent = data.volatility ? (data.volatility * 100).toFixed(2) + '%' : '--';
            
            // Update trading levels
            document.getElementById('entry-price').textContent = formatCurrency(data.entry);
            document.getElementById('stop-loss').textContent = formatCurrency(data.stop_loss);
            if (data.targets && data.targets.length >= 2) {
                document.getElementById('target-1').textContent = formatCurrency(data.targets[0]);
                document.getElementById('target-2').textContent = formatCurrency(data.targets[1]);
            }
            
            // Update explanation
            document.getElementById('explanation-text').textContent = data.explain || 'No explanation available';
            
            // Update feature importance
            updateFeatureImportance(data.feature_importance || {});
            
            // Update performance metrics
            if (data.performance) {
                document.getElementById('total-trades').textContent = data.performance.total_trades || '0';
                document.getElementById('success-rate').textContent = data.performance.rolling_accuracy ? 
                    (data.performance.rolling_accuracy * 100).toFixed(1) + '%' : '--';
                document.getElementById('avg-confidence').textContent = data.performance.avg_confidence ? 
                    (data.performance.avg_confidence * 100).toFixed(1) + '%' : '--';
                document.getElementById('live-accuracy').textContent = data.performance.rolling_accuracy ? 
                    (data.performance.rolling_accuracy * 100).toFixed(1) + '%' : '--';
            }
            
            // Update last update time
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
        }
        
        // Update signal display with animations
        function updateSignalDisplay(data) {
            const signalDisplay = document.getElementById('signal-display');
            const signalText = document.querySelector('.signal-text');
            const confidenceValue = document.getElementById('confidence-value');
            const reliabilityValue = document.getElementById('reliability-value');
            const reliabilityBadge = document.getElementById('reliability-badge');
            
            // Remove existing signal classes
            signalDisplay.className = 'signal-display';
            signalText.className = 'signal-text';
            
            // Add new signal class
            let signalClass = 'signal-hold';
            if (data.signal === 'BUY') signalClass = 'signal-buy';
            else if (data.signal === 'SELL') signalClass = 'signal-sell';
            
            signalDisplay.classList.add(signalClass);
            
            // Update signal text
            signalText.textContent = data.signal;
            
            // Update confidence and reliability
            confidenceValue.textContent = data.confidence ? (data.confidence * 100).toFixed(1) + '%' : '--';
            reliabilityValue.textContent = data.reliability ? (data.reliability * 100).toFixed(1) + '%' : '--';
            
            // Update reliability badge
            reliabilityBadge.className = 'reliability-badge ';
            if (data.reliability >= 0.8) {
                reliabilityBadge.classList.add('reliability-high');
                reliabilityBadge.textContent = 'HIGH';
            } else if (data.reliability >= 0.6) {
                reliabilityBadge.classList.add('reliability-medium');
                reliabilityBadge.textContent = 'MEDIUM';
            } else {
                reliabilityBadge.classList.add('reliability-low');
                reliabilityBadge.textContent = 'LOW';
            }
            
            // Update confidence gauge
            updateConfidenceGauge(data.confidence || 0);
        }
        
        // Update confidence gauge
        function updateConfidenceGauge(confidence) {
            const canvas = document.getElementById('confidenceGauge');
            const ctx = canvas.getContext('2d');
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            const radius = 80;
            
            // Clear canvas
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw background circle
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, 0, 2 * Math.PI);
            ctx.strokeStyle = 'rgba(255,255,255,0.1)';
            ctx.lineWidth = 10;
            ctx.stroke();
            
            // Draw confidence arc
            const startAngle = -Math.PI / 2;
            const endAngle = startAngle + (2 * Math.PI * confidence);
            
            ctx.beginPath();
            ctx.arc(centerX, centerY, radius, startAngle, endAngle);
            ctx.strokeStyle = getConfidenceColor(confidence);
            ctx.lineWidth = 10;
            ctx.stroke();
            
            // Draw confidence text
            ctx.fillStyle = 'white';
            ctx.font = 'bold 24px Arial';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText(Math.round(confidence * 100) + '%', centerX, centerY);
        }
        
        // Get color based on confidence level
        function getConfidenceColor(confidence) {
            if (confidence >= 0.8) return '#10b981';
            if (confidence >= 0.6) return '#f59e0b';
            return '#ef4444';
        }
        
        // Update feature importance display
        function updateFeatureImportance(features) {
            const container = document.getElementById('feature-importance');
            container.innerHTML = '<h4>Feature Importance:</h4>';
            
            // Sort features by importance
            const sortedFeatures = Object.entries(features)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5); // Top 5 features
            
            sortedFeatures.forEach(([feature, importance]) => {
                const featureDiv = document.createElement('div');
                featureDiv.className = 'feature-item';
                featureDiv.innerHTML = `
                    <div style="display: flex; justify-content: space-between; margin: 5px 0;">
                        <span>${feature}</span>
                        <span>${(importance * 100).toFixed(1)}%</span>
                    </div>
                    <div class="feature-bar">
                        <div class="feature-fill" style="width: ${importance * 100}%"></div>
                    </div>
                `;
                container.appendChild(featureDiv);
            });
        }
        
        // Initialize charts
        function initializeCharts() {
            const ctx = document.getElementById('priceChart').getContext('2d');
            priceChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: [],
                    datasets: [{
                        label: 'BTC Price',
                        data: [],
                        borderColor: '#2563eb',
                        backgroundColor: 'rgba(37, 99, 235, 0.1)',
                        borderWidth: 2,
                        fill: true,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        x: {
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: 'rgba(255,255,255,0.7)'
                            }
                        },
                        y: {
                            grid: {
                                color: 'rgba(255,255,255,0.1)'
                            },
                            ticks: {
                                color: 'rgba(255,255,255,0.7)',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // Update system status
        function updateSystemStatus(status) {
            const statusElement = document.getElementById('system-status');
            statusElement.textContent = status.charAt(0).toUpperCase() + status.slice(1);
            statusElement.className = '';
            
            if (status === 'running' || status === 'connected') {
                statusElement.classList.add('pulse');
            }
        }
        
        // Countdown timer
        function startCountdown() {
            setInterval(() => {
                countdown--;
                document.getElementById('countdown').textContent = countdown;
                
                if (countdown <= 0) {
                    countdown = 30;
                }
            }, 1000);
        }
        
        function resetCountdown() {
            countdown = 30;
        }
        
        // Utility functions
        function formatCurrency(amount) {
            if (amount === undefined || amount === null) return '--';
            return '$' + amount.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }
        
        function refreshData() {
            loadInitialData();
            resetCountdown();
        }
        
        function showDemo() {
            // Demo data for testing
            const demoData = {
                signal: 'BUY',
                confidence: 0.82,
                reliability: 0.76,
                sentiment: 'bullish',
                price: 110911.86,
                entry: 110914.59,
                stop_loss: 110947.32,
                targets: [110881.85, 110860.03],
                risk_reward: 3.2,
                volatility: 0.35,
                explain: "Transformer attention: breakout pattern + volume surge ‚Ä¢ RSI indicates oversold conditions ‚Ä¢ High volume confirmation",
                feature_importance: {
                    "price_momentum": 0.32,
                    "volume_trend": 0.28,
                    "rsi_signal": 0.18,
                    "volatility": 0.12,
                    "macd": 0.10
                },
                performance: {
                    total_trades: 45,
                    successful_trades: 32,
                    rolling_accuracy: 0.71,
                    avg_confidence: 0.68
                }
            };
            
            currentData = demoData;
            updateDashboard(demoData);
            isDemoMode = true;
            alert('Demo mode activated with sample data');
        }
        
        function exportData() {
            if (!currentData) {
                alert('No data available to export');
                return;
            }
            
            const dataStr = JSON.stringify(currentData, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `bitcoin-prediction-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>